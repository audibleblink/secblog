<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="security, vulnhub, red team, hackthebox, blue team" name="keywords">
<meta content="Alex Flores" name="author">
<meta property="og:title" content="Password Spraying with DoxyCannon - SecBlog">
<meta property="og:url" content="https://sec.alexflor.es/post/password_spraying_with_doxycannon/">
<meta property="og:description" content="Things have been OK for me except that I&#39;m a zombie now">
<meta property="og:type" content="website" />
<title>Password Spraying with DoxyCannon | SecBlog</title>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<link rel="stylesheet" href="https://sec.alexflor.es/css/style.css">
<link rel="shortcut icon" href="https://sec.alexflor.es/wave.ico">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/atom-one-dark.min.css">

</head>

<body>
<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://sec.alexflor.es"><h1 class="title is-4">SecBlog</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
          <a class="level-item" href="/categories/boot2root" target="_blank">
            <span class="icon">
              <i class="fa fa-terminal"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://github.com/audibleblink" target="_blank">
            <span class="icon">
              <i class="fa fa-github"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://twitter.com/4lex" target="_blank">
            <span class="icon">
              <i class="fa fa-twitter"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://linkedin.com/in/alex2" target="_blank">
            <span class="icon">
              <i class="fa fa-linkedin-square"></i>
            </span>
          </a>
          
          <a class="level-item" href="/index.xml" target="_blank">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>
          </a>
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h1 class="title">Password Spraying with DoxyCannon</h1>
    <h2 class="subtitle is-5">April 16, 2018 by Alex Flores</h2>
    
    <div class="content">
      <p>Password sprays are here to stay. It's probably a good idea to configure some clever WAF rules,
implement captcha systems, and set up additional alerting. But once implemented, how do you test and
tune your protective measures?</p>
<p>Enter <a href="https://github.com/audibleblink/doxycannon">DoxyCannon</a></p>
<p>DoxyCannon's name borrows from ProxyCannon, a script that instantiates cloud infrastructure through
which one can proxy requests. Unlike ProxyCannon, DoxyCannon gives you the same functionality
without needing to rely on cloud providers. Everything is local. DoxyCannon will use Docker and a
collection of OpenVPN config files to create local proxies on localhost. In combination with tools
like proxychains or DoxyCannon's own DoxyProxy, you can shuffle through local proxies for each
request, masking the true IP of the attacking machine.</p>
<p>Let's see what this looks like on the receiving end. First, let's set up DoxyCannon.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git clone https://github.com/audibleblink/doxycannon
cd doxycannon
</code></pre></div><p>We're going to using Private Internet Access as our VPN provider.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">wget  https://www.privateinternetaccess.com/openvpn/openvpn.zip
unzip -d VPN openvpn.zip

<span style="color:#75715e"># Remove whitespace from the ovpn file names</span>
find . -name *ovpn | rename <span style="color:#e6db74">&#39;s/ /_/g&#39;</span>

<span style="color:#75715e"># Append `auth.txt` to the `user-pass-auth` directive</span>
sed -i <span style="color:#e6db74">&#39;s/pass/pass auth.txt/&#39;</span> VPN/*.ovpn

<span style="color:#75715e"># Create your auth.txt file</span>
echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>PIA_USER<span style="color:#e6db74">}</span><span style="color:#e6db74">\n</span><span style="color:#e6db74">${</span>PIA_PASS<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> &gt; VPN/auth.txt
</code></pre></div><p>Once everything's been set up, you can build the image and bring up your PIA containers.
<a href="001.jpg"><img src="001.jpg" alt=""></a></p>
<p>At this point, DoxyCannon has dynamically created a <code>proxychains.conf</code> file for you in the root of
the project directory:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#75715e"># proxychains.conf</span>
<span style="color:#75715e"># ------------------------------------------------------------------------</span>
<span style="color:#75715e"># This file is automatically generated by doxycannon. If you need changes,</span>
<span style="color:#75715e"># make them to the template string in doxycannon.py</span>
<span style="color:#a6e22e">random_chain</span>
<span style="color:#a6e22e">quiet_mode</span>
<span style="color:#a6e22e">proxy_dns</span>
<span style="color:#a6e22e">remote_dns_subnet 224</span>
<span style="color:#a6e22e">tcp_read_time_out 15000</span>
<span style="color:#a6e22e">tcp_connect_time_out 8000</span>

<span style="color:#66d9ef">[ProxyList]</span>
<span style="color:#a6e22e">socks5 127.0.0.1 5000</span>
<span style="color:#a6e22e">socks5 127.0.0.1 5001</span>
<span style="color:#a6e22e">socks5 127.0.0.1 5002</span>
<span style="color:#a6e22e">socks5 127.0.0.1 5003</span>
<span style="color:#66d9ef">[...snip]</span>
<span style="color:#a6e22e">socks5 127.0.0.1 5042</span>
<span style="color:#a6e22e">socks5 127.0.0.1 5043</span>
</code></pre></div><p>If you're using a console application for your spray, you're ready to go:
<a href="003.jpg"><img src="003.jpg" alt="003.jpg"></a></p>
<p>Here's what our web server access logs look like:
<a href="004.jpg"> <img src="004.jpg" alt="004.jpg"> </a></p>
<p>With the <code>--single</code> flag, DoxyCannon also has the ability to create a proxy rotator that provides a
single port at which one can point GUI applications.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Start DoxyProxy</span>
❯❯ ./doxycannon.py --single
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Writing HAProxy configuration
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Image doxyproxy built.
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Staring single-port mode...
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Proxy rotator listening on port 1337. Ctrl-c to quit
</code></pre></div><p>While DoxyProxy is running, applications like Burp Suite can be configured to use port 1337.
DoxyProxy is just another docker container. It runs HAProxy in a layer 4, round-robin
configuration and binds to the host network.</p>
<p><a href="005.jpg"><img src="005.jpg" alt="005.jpg"></a>
<a href="006.jpg"><img src="006.jpg" alt="006.jpg"></a>
<a href="007.jpg"><img src="007.jpg" alt="007.jpg"></a></p>
<p>I'm still adding features to DoxyProxy. Coming up will be the ability to control remote docker
hosts using the official docker sdk.</p>

    </div>
    
        <div class="nav-left">
    <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fsec.alexflor.es%2fpost%2fpassword_spraying_with_doxycannon%2f" title="Share on Facebook" target="_blank"><span class="fa fa-facebook fa-2x" aria-hidden="true"></span></a>
    <a class="nav-item" href="https://plus.google.com/share?url=https%3a%2f%2fsec.alexflor.es%2fpost%2fpassword_spraying_with_doxycannon%2f" title="Share on Google+" target="_blank"><span class="fa fa-google-plus fa-2x" aria-hidden="true"></span></a>
    <a class="nav-item" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsec.alexflor.es%2fpost%2fpassword_spraying_with_doxycannon%2f" title="Share on LinkedIn" target="_blank"><span class="fa fa-linkedin fa-2x" aria-hidden="true"></span></a>
    <a class="nav-item" href="https://twitter.com/home?status=Password%20Spraying%20with%20DoxyCannon - https%3a%2f%2fsec.alexflor.es%2fpost%2fpassword_spraying_with_doxycannon%2f" title="Tweet this" target="_blank"><span class="fa fa-twitter fa-2x"></span></a>
    <a class="nav-item" href="http://www.reddit.com/submit?url=https%3a%2f%2fsec.alexflor.es%2fpost%2fpassword_spraying_with_doxycannon%2f&title=Password%20Spraying%20with%20DoxyCannon" title="Share on Reddit" target="_blank"><span class="fa fa-reddit-alien fa-2x" aria-hidden="true"></span></a>
    
    </div>
    
  </div>
</section>

<section class="section">
  <div class="container">
    <aside><div id="disqus_thread"></div></aside>
    <script type="text/javascript">
      var disqus_shortname = 'blinksec';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <div style='margin: auto; width: 250px'><script src="https://www.hackthebox.eu/badge/1496"></script></div>
    
  </div>
</section>


<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js" integrity="sha256-+bhVTaRmJ/c07eV80nU8gD2cBBF0rYkf1txqXlrbvb0=" crossorigin="anonymous"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/go.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/dockerfile.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/javascript.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/python.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/ruby.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/x86asm.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-12497311-8', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
